<!DOCTYPE html>
<html lang="ru">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>ihnm</title>
        <link rel="stylesheet" href="./ihnm.css">
		<link rel="icon" type="image/png" href="./favicon32x32.png" sizes="32x32">
		<link rel="icon" type="image/png" href="./favicon64x64.png" sizes="64x64">
		<script src="./lib/qrcode.js"></script>
		<style>
			#container {
				max-width: 50em;
				display: flex;
				flex-wrap: wrap;
				margin: auto;
				align-items: center;
				justify-content: center;
				--cell-width: 10em;
			}
			.cell {
				position: relative;
				width: var(--cell-width);
				margin: 0.7em;
				padding: 0;
				border: 1px solid var(--ihnm-color-border);
				border-radius: 16px;
				top: 0;
				overflow: hidden;
				box-shadow: 3px 3px 6px var(--ihnm-color-shadow);
				background-color: var(--ihnm-color-bg);
			}
			.cell:hover {
				filter: drop-shadow(0px 0px 8px var(--ihnm-color-shadow));
			}
			.cell-name {
				display: inline-block;
				text-align: center;
				width: 100%;
				font-family: Geneva, Arial, Helvetica, sans-serif;
				padding: 0.5em 0;
				border-bottom: 1px solid var(--ihnm-color-border);
			}
			.img-placeholder {
				width: var(--cell-width);
				height: var(--cell-width);
			}
			.images {
				position: relative;
			}
			.cell-image {
				background-size: contain;
				background-repeat: no-repeat;
				background-position: center;
				width: var(--cell-width);
				height: var(--cell-width);
				position: absolute;
				left: 0;
				top: 0;
			}
			#qrcode {
				border: 1px solid var(--ihnm-color-border);
			}
		</style>
		<script>
			function addLight(id, name, ext) {
				return `
					#cell-${id} .cell-image.${ext} {
						background-image: url('${name}.${ext}')
					}
				`;
			}

			function addDark(id, name, ext) {
				return `
					@media (prefers-color-scheme: dark) {
						#cell-${id} .cell-image.${ext} {
							background-image: url('${name}(dark).${ext}')
						}
					}
				`;
			}

			function cellImage(href, end) {
				return ` style="background-image: url('${fname}')"></div>`;
			}
		</script>
	</head>
	<body>
		<main>
			<h2>Список страниц</h2>
			<section id="container"></section>
			<h3>Неудачные страницы:</h3>
			<ul id="container-deprecated"></ul>
			<h3>Сгенерированное нейросетями:</h3>
			<ul id="container-ai"></ul>
			<div id="qrcode"></div>
			<p>Исходники: <a href="https://github.com/dnauu-bmsotc/ihnm">https://github.com/dnauu-bmsotc/ihnm</a></p>
		</main>
		<script>
			document.addEventListener('DOMContentLoaded', async function() {
				const response = await fetch("./pages.json");
				const pages = await response.json();

				let style = ``;

				for (let i = 0; i < pages.length; i++) {
					if (pages[i].deprecated || pages[i].ai) {
						const l = document.createElement("li");
						const a = document.createElement("a");
						l.appendChild(a);
						a.href = pages[i].href;
						a.innerText = pages[i].name;
						if (pages[i].deprecated) {
							document.getElementById("container-deprecated").appendChild(l);
						}
						if (pages[i].ai) {
							document.getElementById("container-ai").appendChild(l);
						}
					}
					else {
						const cell = document.createElement("a");
						document.getElementById("container").appendChild(cell);
						cell.outerHTML = `
							<a class="cell" href="${pages[i].href}">
								<div class="cell-name">${pages[i].name}</div>
								<div class="images" id="cell-${i}">
									<div class="img-placeholder"></div>
									<div class="cell-image png"></div>
									<div class="cell-image gif"></div>
								</div>
							</a>
						`;

						const fname = "./previews/" + (pages[i].preview
							? pages[i].preview
							: pages[i].href.substring(pages[i].href.lastIndexOf('/') + 1));

						style += addLight(i, fname, "png");

						pages[i].extra && pages[i].extra.includes("gif") && (style += addLight(i, fname, "gif"));
						pages[i].extra && pages[i].extra.includes("dark") && (style += addDark(i, fname, "png"));
						pages[i].extra && pages[i].extra.includes("dark gif") && (style += addDark(i, fname, "gif"));
					}
				}


				let styleSheet = document.createElement("style");
				styleSheet.innerText = style.replace(/(\r\n|\n|\r)/gm, "");
				document.head.appendChild(styleSheet);

				new QRCode(document.getElementById("qrcode"), window.location.href);
			});
		</script>
	</body>
</html>
