<!DOCTYPE html>
<html lang="ru">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Генератор рек</title>
        <link rel="stylesheet" href="../../ihnm.css">
        <link rel="stylesheet" href="./style.css">
        <script src="./lib/tfjs.js"></script>
        <!-- GIF -->
        <script src="./lib/LZWEncoder.js"></script>
        <script src="./lib/NeuQuant.js"></script>
        <script src="./lib/GIFEncoder.js"></script>
        <script src="./lib/b64.js"></script>

		<script src="./script.js"></script>
	</head>
	<body>
		<main>
            <section id="generations"></section>
            <section id="content">
                <article>
                    <h2>Создать GIF</h2>
                    <span id="error" hidden>Возникла ошибка при загрузке модели или генерации изображений</span>
                    <div id="gif-creator-wrap">
                        <div id="gif-creator-loading"></div>
                        <div id="gif-creator">
                            <div id="settings" hidden>
                                Нервосеть генерирует изображение, используя точку из скрытого пространства,
                                координаты которой состоят из класса изображения и гауссового шума.
                                Кадры анимации создаются линейной интерполяцией между точками из скрытого
                                пространства. После интерполяции будет <span id="created-span"></span>
                                <input id="nInterpolations-input" type="number" value="39" min="2" max="999">
                                <span id="frames1-span"></span>, включая начальную и конечную точки. Начальная
                                точка соответствует классу
                                <select id="class1-input" class="ral-class-select"></select>
                                и шуму с зерном
                                <input id="seed1-input" type="number" value="0" min="0" max="9999">
                                <span id="random_seed1-span">(случайное зерно)</span>.
                                Конечная точка соответствует классу
                                <select id="class2-input" class="ral-class-select"></select>
                                и шуму с зерном
                                <input id="seed2-input" type="number" value="0" min="0" max="9999">
                                <span id="random_seed2-span">(случайное зерно)</span>.
                                <span id="same-points-warning" hidden>Начальная и конечная точки совпадают.</span>
                                Анимация будет иметь частоту
                                <input id="fps-input" type="number" value="8" min="1" max="60">
                                <span id="frames2-span"></span> в секунду; суммарная длительность анимации составит
                                <span id="dur-span"></span> секунд.
                            </div>
                            <image id="gif-img" title="Здесь будет GIF"></image>
                            <button id="create-gif-btn">Создать</button>
                            <span id="note">Примерное время создания первой анимации - 10 секунд</span>
                            <div style="width:2em;height:2em;" onclick="document.getElementById('settings').hidden=false"></div>
                        </div>
                    </div>
                </article>
                <article id="text">
                    <h2>Как это делалось</h2>
                    <p>
                        Сначала на платформе <a href="https://earthengine.google.com/">Google Earth Engine</a> был получен доступ к данным
                        «<a href="https://developers.google.com/earth-engine/datasets/catalog/JRC_GSW1_3_GlobalSurfaceWater">JRC Global Surface Water Mapping Layers, v1.3</a>».
                        Из них были сформированы изображения размером 256x256 пикселей, яркость которых отражает частоту присутствия воды («the frequency with which water was present»)
                        на соответствующих участках поверхности. При линейном разрешении 30 м одно иозбражение охватит участок ~7 км.
                        Для уменьшения затрат времени на получение и дальнейшую обработку изображений область, на которой формировались изображения,
                        была ограничена границами России, полученные из набора данных
                        «<a href="https://developers.google.com/earth-engine/datasets/catalog/USDOS_LSIB_SIMPLE_2017">LSIB 2017: Large Scale International Boundary Polygons, Simplified</a>».
                    </p>
                    <p>
                        Так было получено около 78 тысяч изображений. Большинство изображений оказались почти полностью чёрными.
                        Также, некоторые изображения, соответствующие крайним северным частям страны, оказались с артефактами,
                        напоминающими сильные помехи. После фильтрации по средней яркости и удаления изображений с артефактами,
                        осталось 10 тысяч изображений.
                    </p>
                    <p>
                        Около тысячи изображений были вручную классифицированы в 13 классов.
                        Классификация проводилась только по визуальной схожести рисунков.
                        Рассматривались такие признаки как: наличие реки, ширина реки, извилистость реки,
                        наличие нескольких русел, наличие озёр, количество и размер озёр и др.
                        Затем, используя "fine tuning" модели VGG16, были отклассифицированы оставшиеся изображения.
                    </p>
                    <img src="./media/classes.png">
                    <p>
                        Полученный набор изображений был использован для обучения генеративно-состязательной модели.
                        Из-за недостаточного количества данных для обучения такой модели, размер всех изображений был
                        уменьшен до 28x28 пикселей. Генеративная модель принимает 64 значения (при тренировке генерировались
                        случайные значения по нормальному распределению) + 13 значений которые соответствуют классу
                        изображения (one hot encoding). Генеративная модель имеет около 700 тысяч параметров.
                        Создание и обучение модели производились на платформе <a href="https://www.kaggle.com/">Kaggle</a>.
                        Для создания модели использовалась библиотека <a href="https://keras.io/">Keras</a>.
                        Модель и её веса после обучения были экспортированы в формат, который можно использовать в браузере.
                        Как только завершится загрузка модели, на фоне этой страницы начнут появляться примеры работы генератора.
                    </p>
                    <img src="./media/history.png">
                    <p>
                        Первая строчка кода этого проекта была написана 7 августа 2022 года. И ровно через год, 7 августа 2023 года
                        я дописываю скрипт для генерации изображений в браузере. Я ознакомился с некоторыми этапами создания
                        нейросетей и при работе чувствовал, что то, что я пишу, находится на грани моих способностей.
                        Стало понятно, что дальнейшего продвижения мне необходимо изучить основы методов машинного
                        обучения и библиотек для их реализации.
                    </p>
                    <p>
                        Набор данных доступен по ссылке: <a href="https://disk.yandex.ru/d/ZgQY256sCSSYPQ">https://disk.yandex.ru/d/ZgQY256sCSSYPQ</a>.
                    </p>
                    <p>
                        Исходный код разделён на два Jupyter-ноутбука, доступным по ссылкам:
                    </p>
                    <ol>
                        <li><a href="https://github.com/dnauu-bmsotc/ihnm/tree/main/oeuvres/rivers2/notebooks/rivers-and-lakes-classifier-vgg16-based.ipynb">Классификатор</a></li>
                        <li><a href="https://github.com/dnauu-bmsotc/ihnm/tree/main/oeuvres/rivers2/notebooks/rivers-and-lakes-cgan.ipynb">Нервосеть</a></li>
                    </ol>
                </article>
            </section>
		</main>
	</body>
</html>
