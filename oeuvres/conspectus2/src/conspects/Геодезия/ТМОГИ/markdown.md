## Теория математической обработки геодезических измерений

Основано на лекциях/семинарах Андоленко Светланы Степановны, Курченко Леонида Алексеевича, Пичугиной Елены Алексеевны.

### Аннотация

### ТМОГИ. Измерения и ошибки.

ТМОГИ - это математическая дисциплина, которая изучает и разрабатывает методы оценки точности измерений, методы расчёта точности измерений, а также методы определения наиболее достоверных значений, определяемых неизвестных параметров и их оценки точности.

Если измерения происходят в одних и тех же условиях одним и тем же прибором, одним и тем же исполнителем, то такие измерения называются *равноточными*. *Неравноточные* измерения выполнены различным числом приёмов, различными приборами, утром, вечером...

При геодезических измерениях неизбежны ошибки. Эти ошибки бывают грубые, систематические и случайные.
- К *грубым* относятся просчёты в измерениях. Эти ошибки легко определяются и исключаются из измерений. Данные измерения необходимо перемерить.
- *Систематические* ошибки происходят от известного источника, имеют определённый знак и величину и их можно учесть при измерениях и вычислениях.
- *Случайные* ошибки возникают от воздействия самых разнообразных причин. Влияние их учесть практически невозможно.

Поэтому возникают две задачи, решаемые с помощью теории ошибок измерений:
1. Из результатов измерений получить наиболее точную величину;
2. Оценить точность полученных результатов измерений.

Относительная ошибка — это отношение абсолютной ошибки к значению самой измеренной величины. Относительная ошибка выражается в виде аликвотной дроби, числитель которой — единица, а знаменатель — число округлённое до двух-трёх значащих цифр с нолями в меньшую сторону.





В теории ошибок измерений вводится приближённая формула для определения ошибок
вычисления СКП: mm (средняя квадратическая погрешность средней квадратической по-
грешности)
$$m_m=\frac m{2\sqrt{n}}$$
Так, при n = 8 получим mm = 0.25m (т.е. ошибка вычисления СКП может достигнуть 25%
от её величины, при 8 ⩽ n ⩽ 50 измерений). При n = 50, получим mm = 0.10m;

### Средняя квадратическая ошибка.
#### СКО одного измерения
Точность результатов измерений оценивается средней квадратической погрешностью (СКО одного измерения), предложенной Гауссом:
$$m=\sqrt\frac{[\Delta^2]}n$$
где $\Delta$ - разность между измерением величины и её истинным значением.

#### СКО среднего арифметического
СКО среднего арифметического $\Theta$ измерений $l_i$ выводится следующим образом:
1. Разложим среднее арифметическое: $$\Theta=\frac{l_1}n+\frac{l_2}n+\ldots+\frac{l_n}n$$
2. СКО аналогична квадратному корню дисперсии. При независимых измерениях дисперсия суммы равна сумме дисперсий: $$D\Theta=D\left(\frac{l_1}n\right)+D\left(\frac{l_2}n\right)+\ldots+D\left(\frac{l_n}n\right)$$ $$D\Theta=\frac1{n^2}Dl_1+\frac1{n^2}Dl_2+\ldots+\frac1{n^2}Dl_n$$ $$M^2=\frac{m_1^2}{n^2}+\frac{m_2^2}{n^2}+\ldots+\frac{m_n^2}{n^2}$$
3. Так как измерения равноточны ($m_1=m_2=\ldots=m_n$), то $$M^2=\frac{m^2}n$$
4. Таким образом, среднее арифметическое в $\sqrt n$ раз точнее результата отдельного измерения. $$M=\frac m{\sqrt n}$$

#### СКО функции
Запишем уравнения связи между измеренными значениями и неизвестными
$$Y=\varphi(X)$$
В общем случае уравнения связи нелинейные. Приведём их к линейному виду, разложив в ряд Тейлора:
$$Y=\varphi\left(X^{(0)}\right)+\frac{\partial Y}{\partial X}\left(X-X^{(0)}\right)+\zeta$$
Найдём её дисперсию, приняв, что аргументы функции независимы, и отбросив последний член:
$$DF=D(const)+D\left(\frac{\partial Y}{\partial X}\left(X-X^{(0)}\right)\right)=\left(\frac{\partial Y}{\partial X}\right)^2(DX-DX^{(0)})=\left(\frac{\partial Y}{\partial X}\right)^2DX$$
$$DF=\sum_1^n\left(\frac{\partial F}{\partial x_i}\right)^2Dx_i$$
$$m_F^2=\sum_1^n\left(\frac{\partial F}{\partial x_i}\right)^2m_x^2$$
Если измерения не независимы, то:
$$m_F^2=\sum_1^n\left(\frac{\partial F}{\partial x_i}\right)^2m_x^2+2\sum_{i<j}\frac{\partial F}{\partial x_i}\cdot\frac{\partial F}{\partial x_j}\cdot r_{x_ix_j}m_{x_i}m_{x_j}$$

### Доверительные интервалы

#### Доверительный интервал возможного значения истинной величины измеренного значения

$$\overline x-t_\beta\cdot m_{\overline x}\leq M_x\leq\overline x+t_\beta\cdot m_{\overline x}$$
где $\overline x$ - наиболее достоверное значение измеренной величины; $\beta$ - доверительная вероятность; $t_\beta$ находится по таблице распределения Стьюдента. 

#### Доверительный интервал СКО одного измерения (дисперсии единицы веса)

$$\gamma_1\cdot\mu^2\leq\sigma_0^2\leq\gamma_2\cdot\mu^2$$
Значения $\gamma_1$ и $\gamma_2$ берутся из таблицы исходя из числа степеней свободы и доверительного интервала.
![[коэффициенты гамма1и2-80.png]]

#### Доверительный интервал СКО среднего арифметического (дисперсии среднего весового общей арифметической средины)

$$\gamma_1\cdot M^2\leq\sigma_{\overline x}^2\leq\gamma_2\cdot M^2$$
### Неравноточные измерения

#### СКО неравноточных измерений
Нарушение условий равноточности приводит к измерениям с различными СКО. Для характеристики таких измерений дополнительно вводят понятие веса измерения:
$$p_i=\frac{c}{m_i^2}$$
где $c$ - произвольная величина (дисперсия единицы веса).

Среднее арифметическое в случае неравноточных измерений вычисляется следующим образом:
$$\overline x=\frac{[px]}{[p]}$$
Ошибка единицы веса:
$$\mu=\sqrt{\frac{[p\Delta^2]}n}\quad\text{или}\quad\mu=\sqrt{\frac{[pv^2]}{n-1}}$$
Обычно в формуле веса постоянную $c$ выбирают равной квадрату ошибки единицы веса:
$$p_i=\frac{\mu^2}{m_i^2}\Rightarrow m_i=\frac\mu{\sqrt{p_i}}$$

#### Вес функции
Применим выражение $m_i=\frac\mu{\sqrt{p_i}}$ в формуле СКО функции:
$$\frac{\mu^2}{p_F}=\sum_1^n\left(\frac{\partial F}{\partial x_i}\right)^2\frac{\mu^2}{p_i}$$
Сократив $\mu^2$, получим формулу обратного веса функции:
$$\frac{1}{p_F}=\sum_1^n\left(\frac{\partial F}{\partial x_i}\right)^2\frac{1}{p_i}$$

### Двойные измерения.

Часто в геодезии величины измеряются только два раза. Такие измерения называются двойными. Различают двойные равноточные измерения, когда измерения в парах равноточны, и пары также равноточны между собой, а также двойные неравноточные измерения, когда измерения в парах равноточны, а пары между собой неравноточны.

#### Оценка точности по разностям двойных равноточных измерений.
Пусть имеются двойные равноточные измерения:
$$\begin{aligned}x_1,x_2,\ldots,x_n\\\  x_1',x_2',\ldots,x_n'\end{aligned}$$
и составлены из разности $d_i=x_i-x_i'$. При отсутствии систематических ошибок эти разности можно рассматривать ошибки величин, истинное значение которых равно нулю. Поэтому можем применить формулу Гаусса:
$$m_d=\sqrt{\frac{[d^2]}{n}};\quad m_{x_i}=\sqrt{\frac{}{2}}$$
Точность среднего арифметического из двух измерений:
$$m_{x_{i,ср}}=\frac{m_x}{\sqrt2}$$
На наличие в $d_i$ постоянной систематической ошибки укажет значительное отклонение от нуля величины $\Theta=[d]/n$. В этом случае, рассматривая разности $d_i'=d_i-\Theta$ как уклонения от арифметической средины и применяя формулу Бесселя, получим:
$$m_d=\sqrt{\frac{[d'^2]}{n-1}}$$
На основании формулы $\left|[\Delta]\right|\leq 2.5[\left|\Delta\right|]\sqrt n$ напишем неравенство, при невыполнении которого можно принять гипотезу о наличии в разностях $d_i$ систематической ошибки
$$|[d]|\leq2.5[|d|]/\sqrt n$$

#### Оценка точности по разностям двойных неравноточных измерений.

Рассматривая разность измерений как линейную функцию, можем вычислить вес разности:
$$\frac1{p_{d_i}}=(1)^2\frac1{p_{x_i}}+(-1)^2\frac1{p_{x^\prime_i}}=\frac2{p_{x_i}}$$
$$p_{d_i}=\frac{p_{x_i}}2=\frac{p_i}2$$
При отсутствии систематических ошибок получим ошибку единицы веса и СКО средних значений:
$$\mu=\sqrt{\frac{p_dd^2}n}$$
$$m_{x_{i,ср}}=\frac\mu{\sqrt{2p_i}}$$
Если разности $d_i$ содержат систематические ошибки, то величина $\Theta=[pd]/[p]$ будет заметно отличаться от нуля. Тогда будем иметь:
$$\mu=\sqrt{\frac{[p_dd'^2]}{n-1}}$$
где $d'_i=d_i-\Theta$.

Критерием наличия постоянной систематической ошибки может служить невыполнение неравенства
$$|[p_dd|\leq2.5[|p_dd|]/\sqrt{[p_d]}$$

### Нормальная стандартная величина. Правило трёх сигм.

Величину $t=\frac{x-Mx}{\sigma}$ называют нормальной стандартной величиной. Она обладает следующими свойствами:
1. $Mt=M(\frac{x-Mx}{\sigma})=\frac{1}{\sigma}\left(Mx-M(Mx)\right)=\frac{1}{\sigma}\left(Mx-Mx\right)=0$;
2. $D_t=D(\frac{x-Mx}{\sigma})=\frac{1}{\sigma^2}\left(Dx-D(Mx)\right)=\frac{1}{\sigma^2}\cdot Dx=1$;

Учитывая, что функция Лапласа нечётная, а также с учётом формулы для вычисления $t$, получим
$$mP(|x-a|\leq t\cdot\sigma)=\Phi(t)$$
При $t=1$, $\Phi(t)=0.68$; при $t=2$, $\Phi(t)=0.975$; при $t=3$, $\Phi(t)=0.997$.

Таким образом, если случайная величина распределена нормально, то её отклонение от математического ожидания, взятое по абсолютной величине, не превышает утроенного СКО с вероятностью 99.7%.

### Формула обобщённой оценки точности

Пусть $\varphi(X)$ - вектор-функция, $Y=M\varphi(X)$ - вектор-функция математических ожиданий вектор-функции $\varphi(X)$. Формула обобщённой теоремы оценки точности:
$$K_Y=A\cdot K_X\cdot A^T$$
где $K_Y$ - корреляционная матрица математических ожиданий; $K_X$ - корреляционная матрица аргументов функций; $A$ - матрица частных производных;
$$A_{ij}=\frac{\partial Y_i}{\partial X_j}$$

### Переопределённые системы уравнений. Задача уравнивания.

Часто в геодезической практике число уравнений $n$ больше числа неизвестных $k$. Такую систему уравнений называют переопределённой. Решений она не имеет. Рассмотрим уравнение:
$$\underset{n\times k}{A}\cdot\underset{k\times1}{x}+\underset{n\times 1}{C}=0$$
Чтобы решить данную систему, её умножают слева на $\underset{k\times n}{A^T}\cdot\underset{n\times n}{S}$. Так, система будет состоять из $k$ уравнений и $k$ неизвестных.
$$A^TSAx+A^TSC=0$$
Пусть $\underset{k\times k}{R}=\underset{k\times n}{A^T}\cdot\underset{n\times n}{S}\cdot\underset{n\times k}{A}$; $\underset{k\times1}{b}=\underset{k\times n}{A^T}\cdot\underset{n\times n}{S}\cdot\underset{n\times1}{C}$.
$$\underset{k\times k}{R}\cdot\underset{k\times 1}{x}+\underset{k\times 1}{b}=0$$
Матрица $R$ является нормальной ($R^TR=RR^T$), поэтому полученная система уравнений называется системой нормальных уравнений.

Получим: $$x=-R^{-1}b$$
Но при подстановке данного решения в исходную систему, получим один из следующих случаев:
$$Ax+C=0\quad\text{или}\quad Ax+C=V$$
При $Ax+C=0$ система совместна. При $Ax+C=V$ система несовместна, однако матрица $V$ будет обладать следующим свойством:
$$V^TSV=\min$$
Докажем это свойство. Обозначим $\Phi=V^TSV$, $V=Ax+C$. Найдём экстремум этой функции, приравняв производную к нулю:
$$\frac{\partial\Phi}{\partial x}=\frac{\partial\Phi}{\partial V}\frac{\partial V}{\partial x}=\frac{\partial V^TSV}{\partial V}\frac{\partial Ax+C}{\partial x}=2V^TS\cdot A$$
$$2V^TSA=0$$
$$A^TSV=0$$
$$A^TS(Ax+C)=0$$
$$A^TSAx+A^TSC=0$$
Мы опять пришли к нормальному уравнению. Это значит, что решение уравнения является минимумом функции $\Phi$.

При построении геодезических сетей мы измеряем различные величины: длины линий, углы, превышения, время (в спутниковых сетях) при том, что определяемыми величинами являются плановые и высотные координаты пунктов геодезических сетей.

Число измерений $n$ всегда больше числа координат. Наличие в сети избыточных измерений приводит к неоднозначности определения неизвестных. В этом случае возникает задача уравнивания.

Задачей уравнивания называется определение наиболее достоверных значений неизвестных и оценка их точности. Несмотря на сложность задачи, избыточные измерения позволяют контролировать результаты измерений, выполнять оценку точности и повышать надёжность результатов.

Существует два основных способа уравнивания: параметрический и коррелатный.

Обозначают:
$X$ - истинные значения неизвестных параметров;
$Y$ - истинные значения измеренных величин;
$y$ - результаты измерений.

### Параметрический способ уравнивания.

#### Вывод основных формул, порядок уравнивания.

Запишем уравнения связи между измеренными значениями и неизвестными
$$Y=\varphi(X)$$
В общем случае уравнения связи нелинейные. Приведём их к линейному виду, разложив в ряд Тейлора:
$$Y=\varphi\left(X^{(0)}\right)+\left(\frac{\partial Y}{\partial X}\right)\left(X-X^{(0)}\right)+\zeta$$
Где $X^{(0)}$ - приближённое значение неизвестных; $\zeta$ - остаточный член.
Примем $\left(\frac{\partial Y}{\partial X}\right)=A$; $\zeta=0$; $X-X^{(0)}=\Delta X$; $\varphi(X^{(0)})-Y=\overline{L}$.
$$\underset{n\times k}{A}\cdot\underset{k\times 1}{\Delta X}+\underset{n\times 1}{\overline L}=0$$
Данная система является переопределённой, т.к. $n>k$. Ранее, чтобы перейти к определённой системе, мы умножали её слева на $A^TS$, где $S$ - квадратная матрица размера $n\times n$. В геодезии в качестве матрицы $S$ мы используем матрицу весов измерений $P$.
$$A^TPA\Delta X+A^TP\overline{L}=0$$
Пусть $R=A^TPA$, $\overline{b}=A^TP\overline{L}$
$$R\Delta X+\overline{b}=0$$
$$\Delta X=-R^{-1}\overline{b}$$
Из принятого ранее $X-X^{(0)}=\Delta X$, получим:
$$X=X^{(0)}+\Delta X$$
Задача была бы решена, если бы нам был известен вектор $Y$ истинных измерений. Но у нас есть лишь результаты измерений $y$. И вместо вектора $\overline{L}$ мы вычислим вектор $L$:
$$L=\varphi(X^{(0)})-y$$
Тогда вместо поправок к истинным значениям неизвестных мы получим поправки к уравненным значениям неизвестных.
$$R\Delta x+b=0,\quad b=A^TPL$$
$$\Delta x=-R^{-1}b$$
$$\widetilde{X}=X^{(0)}+\Delta x$$
Если теперь полученный вектор-решение $\Delta x$ подставить в переопределённую систему уравнений, получим несовместную систему:
$$A\Delta x+L=V$$
где $V$ - поправка к измеренному значению, полученное из уравнивания. Если в исходную систему связи измеренных значений и неизвестных вместо истинного значения $X$ подставить уравненное $\widetilde{X}$, то получим уравненное значение измерений. 
$$\widetilde{y}=y+V=\varphi(\widetilde{X})$$

Порядок уравнивания параметрическим способом:
1. Выбираем неизвестные и обозначаем из за $X$;
2. Составляем уравнения связи между измеренными значениями и неизвестными в виде функции от неизвестных $$y=\varphi(x)$$
3. Составляем параметрические уравнения поправок $$\underset{n\times1}{V}=\underset{n\times k}{A}\cdot\underset{k\times 1}{\Delta x}+\underset{n\times 1}{L}$$ где $V$ - матрица поправок к измеренным значениям, полученным из уравнивания; $A$ - матрица коэффициентов уравнений поправок; $L$ - матрица свободных членов уравнений поправок. В подробной записи: $$\underset{n\times k}{A}=\begin{pmatrix}a_1&b_1&\ldots&g_1\\\ a_2&b_2&\ldots&g_2\\\ \vdots&\vdots&\ddots&\vdots\\\ a_n&b_n&\ldots&g_n\end{pmatrix}$$$$a_{ij}=\frac{\partial y_i}{\partial x_j}$$ $$v_i=a_i\delta x_i+b_i\delta x_2+\ldots+g_i\delta x_k+l_i$$ $$a_i=\frac{\partial y_i}{\partial x_1};\quad b_i=\frac{\partial y_i}{\partial x_2};\quad\ldots;\quad g_i=\frac{\partial y_i}{\partial x_k};\quad l_i=\varphi_i(x)-y$$
4. Находим приближённые значения неизвестных $X^{(0)}$ и вычисляем свободные члены параметрических уравнений поправок $$L=\varphi(x)-y$$
5. Составим систему нормальных уравнений $$R\Delta x+b=0$$ где $R=A^TPA$ - матрица коэффициентов нормальных уравнений. Она имеет следующие свойства:
	1. Под диагонали стоят квадратичные элементы;
	2. Недиагональные элементы симметричны относительно главной диагонали;
	3. Определитель матрицы $R$ положительный.
6. Находим поправки к приближённым значениям неизвестных как вектор решения нормальных уравнений: $$\Delta x=-R^{-1}b$$
7. Вычисляем уравненное значение неизвестных: $$\widetilde{X}=X^{(0)}+\Delta x$$
8. Оценка точности.

#### Контроль уравнительных вычислений.

Контроль уравнительных вычислений выполняется вычислением квадратичной формы $\Phi$ двумя способами. Первый способ:

$$\Phi=[pv^2]=V^TPV=(A\Delta x+L)^TP(A\Delta x+L)=$$
$$=(\Delta x^TA^T+L^T)P(A\Delta x+L)=(\Delta x^TA^TP+L^TP)(A\Delta x+L)=$$
$$=\Delta x^TA^TPA\Delta x+\Delta x^TA^TPL+L^TPA\Delta x+L^TPL=$$
$$=\Delta x^T(\underbrace{A^TPA\Delta x+A^TPL}_{R\Delta x+b=0})+L^TPA\Delta x+L^TPL=$$
$$=L^TPA\Delta x+L^TPL=b^T\Delta x+L^TPL$$

Второй способ. Сначала вычислим уравненное значение свободного члена.
$$L=\varphi(X^{(0)})-y$$
$$\widetilde{L}=\varphi(X^{(0)}+\Delta x)-y=\varphi(\widetilde{X})-y$$
При его вычислении уже был учтён вектор решения $\Delta x$, поэтому вместо $\Phi=b^T\Delta x+L^TPL$ можно записать:
$$\Phi=\widetilde{L}^TP\widetilde{L}$$

Контролем уравнительных вычислений будет соблюдение равенств $\Phi$, полученных по двум формулам в пределах ошибки округления.

#### Оценка точности в параметрическом способе уравнивания.

#### Ошибка единицы веса

Ошибка единицы веса вычисляется по формуле:
$$\mu=\sqrt{\frac{[pv^2]}{n-k}}$$
где $[pv^2]=\Phi$; $n$ - общее число измерений; $k$ - число необходимых измерений. Эта формула называется формулой Бесселя при уравнительных вычислениях. Вывод этой формулы содержится в коррелатном способе уравнивания.

#### Оценка точности уравненных неизвестных
$$\widetilde{X}=X^{(0)}+\Delta x$$
Так как $\widetilde{X}$ представляет собой несколько функций, для оценки точности этих величин надо знать корреляционную матрицу, которая может быть получена по обобщённой теореме оценки точности. Но чтобы использовать эту теорему, необходимо выразить уравнение в виде линейной функции с известной корреляционной матрицей.
$$\widetilde{X}=X^{(0)}+(-R^{-1}b)=$$
$$=X^{(0)}+\left(-(A^TPA)^{-1}A^TPL\right)=$$
$$=X^{(0)}+\left(-(A^TPA)^{-1}A^TP(\varphi(X^{(0)})-y)\right)=$$
$$=X^{(0)}+R^{-1}A^TP\varphi(X^{(0)})+R^{-1}A^TPy$$
Обозначим $C_1=X^{(0)}+R^{-1}A^TP\varphi(X^{(0)})$; $C=R^{-1}A^TP$. Получим:
$$\widetilde{X}=Cy+C_1$$
Применим обобщённую теорему оценки точности:
$$K_{\widetilde{X}}=CK_yC^T=R^{-1}A^TPK_yPAR^{-1}$$
Любую неравноточную величину можно оценить по формуле:
$$\sigma_i=\sigma_o\sqrt{\frac{1}{P_i}}$$
где $\sigma_i$ - СКО $i$-й неравноточной величины; $\sigma_0$ - СКО единицы веса. Если измерения независимы, то корреляционную матрицу измерений $K_y$ можно представить в виде
$$K_y=diag\{\sigma_i^2\}=\sigma_0^2\cdot P^{-1}$$
Вернёмся к обобщённой теореме оценки точности:
$$K_{\widetilde{X}}=\sigma_0^2\cdot R^{-1}\underbrace{A^TPP^{-1}PA^T}_{R}R^{-1}=\sigma_0^2\cdot R^{-1}$$

Обозначим $Q=R^{-1}$ - матрица обратных весов уравненных неизвестных. На диагонали у неё будут стоять обратные веса ($Q_{ii}=\frac{1}{P_{\widetilde{X_i}}}$), а недиагональные элементы - это корреляционные моменты.
$$K_{x_ix_j}=\sigma_0^2Q_{ij};\quad r_{x_ix_j}=\frac{K_{x_ix_j}}{\sigma_{x_i}\sigma_{x_j}}=\frac{\sigma_0^2Q_{ij}}{\sigma_0\sqrt{Qii}\cdot\sigma_0\sqrt{Q_{jj}}}=\frac{Q_{ij}}{\sqrt{Qii}\sqrt{Q_{jj}}}$$

#### Оценка точности функции уравненных неизвестных

Часто нужно оценить не только уравненные неизвестные, но и их функции (превышения, длины линий, дирекционные углы).
$$\widetilde{F}=F(\widetilde{X_1}, \widetilde{X_2},\ldots,\widetilde{X_k})$$
В общем случае функция уравненных весов нелинейна. Приведём её к линейному виду, используя ряд Тейлора.
$$\widetilde{F}=F\left(X^{(0)}\right)+\left(\frac{\partial\widetilde F}{\partial X}\right)\left(\widetilde{X}-X^{(0)}\right)+\zeta$$
Пусть $\frac{\partial\widetilde{F}}{\partial X}=\varphi$, $\varphi_{ij}=\frac{\partial F_i(\widetilde X)}{\partial X_j}$, $\zeta=0$, $\widetilde{X}-X^{(0)}=\Delta x$
$$\widetilde{F}=F(X^{(0)})+\varphi\Delta x$$
Для оценки точности функции уравненных значений $\widetilde{F}$ применим обобщённую теорему оценки точности.
$$K_{\widetilde{F}}=\varphi K_{\Delta x}\varphi^T$$
Учитывая, что $K_{\Delta x}=K_{\widetilde{x}}=\sigma_0^2\cdot Q$, получим:
$$K_{\widetilde{F}}=\sigma_0^2\cdot\varphi Q\varphi^T=\sigma_0^2\cdot P_{\widetilde{F}}^{-1}$$
Откуда $$P_{\widetilde{F}}^{-1}=\varphi Q\varphi^{T}$$
### Коррелатный способ уравнивания.

#### Вывод основных формул коррелатного способа уравнивания

Коррелатный способ уравнивания основан на точных геометрических условиях, возникающих в геодезических сетях. Например, в треугольнике точное геометрическое условие возникнет, если будут измерены все три угла. Для определения всех углов треугольника достаточно знать два из них. Измерение третьего узла в треугольнике является избыточным. Но пока мы не знаем третий угол, геометрическое условие не возникнет. Каждое избыточное измерение в геодезической сети приводит к возникновению геометрической зависимости.

В общем виде любое геометрическое условие можно записать как:
$$\varphi(Y)=0$$
В общем виде это уравнение нелинейно. Приведём его к линейному виду, разложив в ряд Тейлора и отбросив остаточные члены разложения.
$$\varphi(Y)=\varphi(Y^{(0)})+\frac{\partial\varphi(Y)}{\partial Y}(Y-Y^{(0)})+\xi$$
Примем в качестве приближённого значения истинного результата измерений измеренное значение $y$: $Y^{(0)}=y$.
$$\varphi(Y)=\varphi(y)+\frac{\partial\varphi(Y)}{\partial Y}(Y-y)$$
Примем $\frac{\partial\varphi(Y)}{\partial Y}=B$; $y-Y=\Delta$; $\varphi(y)-\varphi(Y)=w$.
$$\underset{r\times n}{B}\cdot\underset{n\times1}{(-\Delta)}+\underset{r\times1}{w}=0$$
Эта система является недоопределённой. Введём поправки $V=-\Delta$
$$BV+w=0$$
Эта система называется системой условных уравнений поправок. Для отыскания $V$ решим систему под условием метода наименьших квадратов ($\Phi=V^TPV=min$). Лагранж предложил решить эту систему при помощи неопределённых множителей $\lambda$. Для этого введём функцию, являющуюся суммой условия минимума и данной системы, умноженной на неопределённые множители.
$$G=V^TPV+\lambda(BV+w)$$
Так как множители Лагранжа не определены, заменим их коррелатными ($\lambda=-2K^T$).
$$G=V^TPV-2K^T(BV+w)$$
Найдём производную и приравняем её к нулю.
$$2V^TP-2K^TBV=0$$
$$V^T=K^TBP^{-1}$$
$$V=P^{-1}B^TK$$
Для определения вектора коррелат подставим это решение в систему условных уравнений поправок.
$$BP^{-1}B^TK+w=0$$
Пусть $BP^{-1}B^T=N$
$$NK+w=0$$
Мы получили определённую систему, называемую системой нормальных уравнений коррелатного способа.
$$K=-N^{-1}w$$
Теперь возможно вычислить вектор поправок к измеренным значениям ($V$).
#### Порядок уравнивания коррелатным способом

1. Подсчитываем количество избыточных измерений;
2. Составляем геометрические условия (в уравнивание включаем только независимые геометрические условия. Их число будет равно числу избыточных измерений);
3. Составляем условные уравнения поправок $$BV+w=0$$
4. Определяем невязки условных уравнений;
5. Составляем нормальные уравнения коррелат $$NK+w=0$$
6. Получаем коррелаты из решения нормальных уравнений $$K=-N^{-1}w$$
7. Вычисляем поправки к измеренным значениям $$V=P^{-1}B^TK$$
8. Вычисляем уравненные значения измерений;
9. Вычисляем уравненные значения неизвестных, используя уравненные значения измерений по формулам, известным из геодезии;
10. Оценка точности.

Пример. Уравнять углы в треугольнике коррелатным способом.

1. $r=2$;
2. $Y_1+Y_2+Y_3-180^\circ=0$;
3. $BV+w=0,\quad v1+v2+v3+w=0$;
4. $w=y_1+y_2+y_3-180^\circ$
5. $NK+w=0$;
6. $N=BB^T=(111)\cdot(111)^T=3,\quad 3K+w=0,\quad K=-w/3;$
7. $V=B^TK=(-w/3,-w/3,-w/3)$;
8. $\widetilde{y_i}=y_i-w/3$.

#### Контроль грубых ошибок по невязкам условных уравнений

Одним из преимуществ коррелатного способа является возможность контроля грубых ошибок измерений. Запишем линейный вид исходного уравнения связи.
$$B(-\Delta)+w=0$$
$$w=B\cdot\Delta$$
Рассмотрим свойства невязок. Найдём математическое ожидание невязки.
$$M_w=B\cdot M_\Delta$$
Будем считать, что систематической ошибки нет. Математическое ожидание случайной ошибки равно нулю. Случайные ошибки подчиняются нормальному закону распределения, значит и невязка подчиняется нормальному закону распределения. А значит, к невязкам может быть применено правило трёх сигм.
$$|d_j|=3\sigma_{w_j}$$
Если окажется, что полученная невязка больше предельной, то в измерениях присутствует грубая ошибка и измерения необходимо повторить.

Найдём корреляционную матрицу невязки, чтобы определить СКО $\sigma_w$
$$K_\Delta=K_y=\sigma_0^2P^{-1}$$
Применим обобщённую теорему оценки точности
$$K_w=BK_\Delta B^T=\sigma_0^2BP^{-1}B^T=\sigma_0^2N$$
Обратная весовая матрица невязок совпадает с матрицей коэффициентов нормальных уравнений коррелат.
$$P_w^{-1}=N$$
Мы знаем, что диагональные элементы это дисперсии. Тогда для любой невязки $w_j$:
$$\sigma_{w_j}^2=\sigma_0^2\frac{1}{P_{w_j}}=\sigma_0^2N_{jj}$$
$$\sigma_{w_j}=\sigma_0\sqrt{\frac1{P_{w_j}}}=\sigma_0\sqrt{N_{jj}}$$
Тогда
$$d_j=t\sigma_0\sqrt{N_{jj}}=3\sigma_0\sqrt{N_{jj}}$$
По этой формуле производят отбраковку грубых ошибок по невязкам условных уравнений.

#### Оценка точности в коррелатном способе уравнивания

1 формула.
Контрольные формулы для вычисления квадратичной формы $[pvv]$.
$$V=P^{-1}B^TK$$
$$V^TPV=K^TBP^{-1}PP^{-1}B^TK$$
Учитывая, что $BP^{-1}B^T=N$:
$$\boxed{V^TPV=K^TNK}$$

2 формула.
$$NK+w=0$$
$$NK=-w$$
$$\boxed{V^TPV=-K^Tw=-[kw]}$$
Чаще всего для контроля используется вторая формула.

$$K=-N^{-1}w$$
$$K^T=-w^TN^{-1}$$
$$\boxed{V^TPV=w^TN^{-1}w}$$

#### Вывод формулы Бесселя для вычисления ошибки единицы веса

Вспомним формулу Гаусса для вычисления оценки дисперсии единицы веса - ошибки единицы веса.
$$\mu^2=\frac{[p\Delta\Delta]}n$$
$\Delta$ - истинная ошибка измерений; $p$ - вес измерения.
В матричном виде:
$$\mu^2=\frac{\Delta^TP\Delta}{n}$$
Эта формула применяется и при зависимых измерений. Её ещё называют обобщённой формулой Гаусса.

Истинные ошибки нам практически никогда не известны. Так как невязка является истинной ошибкой нуля, в этой формуле истинные ошибки заменим невязками.
$$\mu^2=\frac{w^TP_ww}{r}$$
Вспомним, что $P_w=N^{-1}$.
$$\mu^2=\frac{w^TN^{-1}w}{r}$$
Согласно третьей контрольной формуле
$$V^TPV=w^TN^{-1}w$$
Тогда
$$\mu^2=\frac{V^TPV}{r}$$
В подробной записи
$$\mu^2=\frac{[pvv]}{r}$$
#### Оценка точности измерений при коррелатном способе уравнивания

Для оценки точности любой системы функций необходимо определить её корреляционную матрицу
$$\widetilde{y}=y+V$$
$$V=P^{-1}B^TK=-P^{-1}B^TN^{-1}w$$
$$\widetilde y=y-P^{-1}B^TN^{-1}w$$
Учитывая, что $W=B\cdot\Delta$ и $\Delta=y-Y$, запишем формулу в виде
$$\widetilde y=Y+\Delta-P^{-1}B^TN^{-1}B\Delta$$
Вынесем $\Delta$ за скобки и обозначим $E-P^{-1}B^TN^{-1}B=C$
$$\widetilde y=Y+C\Delta$$
Применим к выражению обобщённую теорему оценки точности.
$$P_{\widetilde y}^{-1}=CP_\Delta^{-1}C^T=(E-P^{-1}B^TN^{-1}B)P^{-1}(E-P^{-1}B^TB^{-1}B)^T$$
$$=P^{-1}-P^{-1}B^TN^{-1}BP^{-1}-P^{-1}B^TN^{-1}BP^{-1}+P^{-1}B^TN^{-1}BP^{-1}B^TN^{-1}BP^{-1}$$
Учитывая, что $BP^{-1}B^T=N$:
$$P_{\widetilde y}^{-1}=P^{-1}-P^{-1}BN^{-1}BP^{-1}$$
В полученной матрице $P^{-1}$ обратные веса уравненных измерений находятся на диагонали.

Вторую часть полученных формул можно трактовать как обратный вес поправки.
$$P_V^{-1}=P^{-1}B^TN^{-1}BP^{-1}$$
Тогда формулы вычисления обратных весов можно записать в виде
$$P_{\widetilde y}^{-1}=P_y^{-1}-P_V^{-1}$$
Перейдём
$$m_{\widetilde y_i}=\mu\sqrt{\frac1{P_{\widetilde{y_i}}}}$$

#### Оценка точности функций уравненных измерений

$$\widetilde F=F(\widetilde y_1,\widetilde y_2,\ldots,\widetilde y_n)$$
В параметрическом способе мы доказали, что обратный вес функции уравненных значений определяют по формуле
$$P_{\widetilde F}^{-1}=fQf^T=fP^{-1}f^T$$
Подставим в эту формулу обратный вес уравненных измерений
$$P_{\widetilde F}^{-1}=fP_{\widetilde y}^{-1}f^T=fP^{-1}B^TN^{-1}BP^{-1}f^T$$
В коррелатном способе элементы весовой матрицы $f$ будут равны частным производным от функции по каждому измерению
$$f_{ij}=\frac{\partial \widetilde F_i}{\partial y_j}$$
В матрице $P_{\widetilde F}^{-1}$ по диагонали будут стоять обратные веса функций уравненных измерений, выбранные для оценки.

СКО любой $i$-й функции
$$m_{\widetilde F_i}=\mu\sqrt{\frac{1}{P_{\widetilde F_i}}}$$

#### Повышение веса в результате уравнивания

Рассмотрим эту задачу на примере уравненных углов треугольника. Углы в треугольнике равноточны. Поэтому используем формулу обратного веса уравненных углов для равноточных измерений.
$$P_{\widetilde y}^{-1}=E-B^TN^{-1}B$$
$$B=\begin{pmatrix}1&1&1\end{pmatrix}$$
$$N=BB^T=3$$
$$P_{\widetilde y}^{-1}=\begin{pmatrix}1&0&0\\\ 0&1&0\\\ 0&0&1\end{pmatrix}-\frac13\begin{pmatrix}1\\\ 1\\\ 1\end{pmatrix}\begin{pmatrix}1&1&1\end{pmatrix}=\frac13\begin{pmatrix}2&-1&-1\\\ -1&2&-1\\\ -1&-1&2\end{pmatrix}$$
$$P_{\widetilde y_i}^{-1}=\frac23P_{\widetilde y_i}=1.5$$
Как видим, после уравнивания вес увеличился. В общем случае соотношение веса уравненного к неуравненному
$$\frac{P_{\widetilde y}}{P_y}=\frac nk$$
Это соотношение выполняется для простейших случаев. Для сложных геодезических сетей оно выполняется в среднем для сети. Для тригонометрического хода, уравненного по углам:
$$P_{\widetilde y}^{-1}=n\begin{pmatrix}n-1&-1&\ldots&-1\\\ -1&n-1&\ldots&-1\\\  \vdots&\vdots&\ddots&\vdots\\\ -1&-1&\ldots&n-1\end{pmatrix}$$
### Примеры задач
#### Вычисление СКО функции

Напишите формулу для вычисления СКО значения функции $u=L\cdot cos^2\nu$

$$m_u^2=\sum_{i=1}^n\left(\frac{\partial u}{\partial x_i}\right)^2m_{x_i}^2$$
$$m_u^2=\left(\frac{\partial u}{\partial L}\right)^2m_L^2+\left(\frac{\partial u}{\partial \nu}\right)^2m_\nu^2$$
$$\frac{\partial u}{\partial L}=cos^2\nu$$
$$\frac{\partial u}{\partial\nu}=cos^4\nu\cdot m_L^2+L^2sin^22\nu\cdot m_\nu^2$$
$$m_u=\sqrt{cos^4\nu\cdot m_L^2+L^2sin^22\nu\cdot m_\nu^2}$$
#### Обратная задача оценки точности

Превышения определяются по формуле тригонометрического нивелирования. С какой точностью должны быть измерены расстояние $S$ и угол наклона $\nu$, если требуется получить превышения с точностью не грубее $m_h=5$см при измеряемых $S\leq 250$м и $|\nu|\leq6^\circ$.
$$h=S\cdot tg\nu$$
$$m_{x_i}=\frac{m_u}{\left|\frac{\partial u}{\partial x_i}\right|\sqrt n}$$
$$\frac{\partial h}{\partial S}=tg\nu$$
$$\frac{\partial h}{\partial\nu}=\frac{S}{cos^2\nu}$$
$$m_S\leq\frac{m_h}{\left|\frac{\partial h}{\partial S}\right|\cdot\sqrt n}=33,6\text{см}$$
$$m_\nu\leq\frac{m_h\cdot\rho'}{\left|\frac{\partial h}{\partial \nu}\right|\cdot\sqrt n}=0,5'$$
