## Теория математической обработки геодезических измерений

Основано на лекциях/семинарах Андоленко Светланы Степановны и Курченко Леонида Алексеевича.

### Аннотация

### ТМОГИ. Измерения и ошибки.

ТМОГИ - это математическая дисциплина, которая изучает и разрабатывает методы оценки точности измерений, методы расчёта точности измерений, а также методы определения наиболее достоверных значений, определяемых неизвестных параметров и их оценки точности.

Если измерения происходят в одних и тех же условиях одним и тем же прибором, одним и тем же исполнителем, то такие измерения называются *равноточными*. *Неравноточные* измерения выполнены различным числом приёмов, различными приборами, утром, вечером...

При геодезических измерениях неизбежны ошибки. Эти ошибки бывают грубые, систематические и случайные.
- К *грубым* относятся просчёты в измерениях. Эти ошибки легко определяются и исключаются из измерений. Данные измерения необходимо перемерить.
- *Систематические* ошибки происходят от известного источника, имеют определённый знак и величину и их можно учесть при измерениях и вычислениях.
- *Случайные* ошибки возникают от воздействия самых разнообразных причин. Влияние их учесть практически невозможно.

Поэтому возникают две задачи, решаемые с помощью теории ошибок измерений:
1. Из результатов измерений получить наиболее точную величину;
2. Оценить точность полученных результатов измерений.

Относительная ошибка — это отношение абсолютной ошибки к значению самой измеренной величины. Относительная ошибка выражается в виде аликвотной дроби, числитель которой — единица, а знаменатель — число округлённое до двух-трёх значащих цифр с нолями в меньшую сторону.





В теории ошибок измерений вводится приближённая формула для определения ошибок
вычисления СКП: mm (средняя квадратическая погрешность средней квадратической по-
грешности)
$$m_m=\frac m{2\sqrt{n}}$$
Так, при n = 8 получим mm = 0.25m (т.е. ошибка вычисления СКП может достигнуть 25%
от её величины, при 8 ⩽ n ⩽ 50 измерений). При n = 50, получим mm = 0.10m;

### Средняя квадратическая ошибка.
#### СКО одного измерения
Точность результатов измерений оценивается средней квадратической погрешностью (СКО одного измерения), предложенной Гауссом:
$$m=\sqrt\frac{[\Delta^2]}n$$
где $\Delta$ - разность между измерением величины и её истинным значением.

#### СКО среднего арифметического
СКО среднего арифметического $\Theta$ измерений $l_i$ выводится следующим образом:
1. Разложим среднее арифметическое: $$\Theta=\frac{l_1}n+\frac{l_2}n+\ldots+\frac{l_n}n$$
2. СКО аналогична квадратному корню дисперсии. При независимых измерениях дисперсия суммы равна сумме дисперсий: $$D\Theta=D\left(\frac{l_1}n\right)+D\left(\frac{l_2}n\right)+\ldots+D\left(\frac{l_n}n\right)$$ $$D\Theta=\frac1{n^2}Dl_1+\frac1{n^2}Dl_2+\ldots+\frac1{n^2}Dl_n$$ $$M^2=\frac{m_1^2}{n^2}+\frac{m_2^2}{n^2}+\ldots+\frac{m_n^2}{n^2}$$
3. Так как измерения равноточны ($m_1=m_2=\ldots=m_n$), то $$M^2=\frac{m^2}n$$
4. Таким образом, среднее арифметическое в $\sqrt n$ раз точнее результата отдельного измерения. $$M=\frac m{\sqrt n}$$

#### СКО функции
Запишем уравнения связи между измеренными значениями и неизвестными
$$Y=\varphi(X)$$
В общем случае уравнения связи нелинейные. Приведём их к линейному виду, разложив в ряд Тейлора:
$$Y=\varphi\left(X^{(0)}\right)+\frac{\partial Y}{\partial X}\left(X-X^{(0)}\right)+\zeta$$
Найдём её дисперсию, приняв, что аргументы функции независимы, и отбросив последний член:
$$DF=D(const)+D\left(\frac{\partial Y}{\partial X}\left(X-X^{(0)}\right)\right)=\left(\frac{\partial Y}{\partial X}\right)^2(DX-DX^{(0)})=\left(\frac{\partial Y}{\partial X}\right)^2DX$$
$$DF=\sum_1^n\left(\frac{\partial F}{\partial x_i}\right)^2Dx_i$$
$$m_F^2=\sum_1^n\left(\frac{\partial F}{\partial x_i}\right)^2m_x^2$$
Если измерения зависимы, то:
$$m_F^2=\sum_1^n\left(\frac{\partial F}{\partial x_i}\right)^2m_x^2+2\sum_{i<j}\frac{\partial F}{\partial x_i}\cdot\frac{\partial F}{\partial x_j}\cdot r_{x_ix_j}m_{x_i}m_{x_j}$$

### Неравноточные измерения

#### СКО неравноточных измерений
Нарушение условий равноточности приводит к измерениям с различными СКО. Для характеристики таких измерений дополнительно вводят понятие веса измерения:
$$p_i=\frac{c}{m_i^2}$$
где $c$ - произвольная величина (дисперсия единицы веса).

Среднее арифметическое в случае неравноточных измерений вычисляется следующим образом:
$$\overline x=\frac{[px]}{[p]}$$
Ошибка единицы веса:
$$\mu=\sqrt{\frac{[p\Delta^2]}n}\quad\text{или}\quad\mu=\sqrt{\frac{[pv^2]}{n-1}}$$
Обычно в формуле веса постоянную $c$ выбирают равной квадрату ошибки единицы веса:
$$p_i=\frac{\mu^2}{m_i^2}\Rightarrow m_i=\frac\mu{\sqrt{p_i}}$$

#### Вес функции
Применим выражение $m_i=\frac\mu{\sqrt{p_i}}$ в формуле СКО функции:
$$\frac{\mu^2}{p_F}=\sum_1^n\left(\frac{\partial F}{\partial x_i}\right)^2\frac{\mu^2}{p_i}$$
Сократив $\mu^2$, получим формулу обратного веса функции:
$$\frac{1}{p_F}=\sum_1^n\left(\frac{\partial F}{\partial x_i}\right)^2\frac{1}{p_i}$$

### Двойные измерения.

Часто в геодезии величины измеряются только два раза. Такие измерения называются двойными. Различают двойные равноточные измерения, когда измерения в парах равноточны, и пары также равноточны между собой, а также двойные неравноточные измерения, когда измерения в парах равноточны, а пары между собой неравноточны.

#### Оценка точности по разностям двойных равноточных измерений.
Пусть имеются двойные равноточные измерения:
$$\begin{aligned}x_1,x_2,\ldots,x_n\\x_1',x_2',\ldots,x_n'\end{aligned}$$
и составлены из разности $d_i=x_i-x_i'$. При отсутствии систематических ошибок эти разности можно рассматривать ошибки величин, истинное значение которых равно нулю. Поэтому можем применить формулу Гаусса:
$$m_d=\sqrt{\frac{[d^2]}{n}};\quad m_{x_i}=\sqrt{\frac{}{2}}$$
Точность среднего арифметического из двух измерений:
$$m_{x_{i,ср}}=\frac{m_x}{\sqrt2}$$
На наличие в $d_i$ постоянной систематической ошибки укажет значительное отклонение от нуля величины $\Theta=[d]/n$. В этом случае, рассматривая разности $d_i'=d_i-\Theta$ как уклонения от арифметической средины и применяя формулу Бесселя, получим:
$$m_d=\sqrt{\frac{[d'^2]}{n-1}}$$
На основании формулы $\left|[\Delta]\right|\leq 2.5[\left|\Delta\right|]\sqrt n$ напишем неравенство, при невыполнении которого можно принять гипотезу о наличии в разностях $d_i$ систематической ошибки
$$|[d]|\leq2.5[|d|]/\sqrt n$$

#### Оценка точности по разностям двойных неравноточных измерений.

Рассматривая разность измерений как линейную функцию, можем вычислить вес разности:
$$\frac1{p_{d_i}}=(1)^2\frac1{p_{x_i}}+(-1)^2\frac1{p_{x'_i}}=\frac2{p_{x_i}}$$
$$p_{d_i}=\frac{p_{x_i}}2=\frac{p_i}2$$
При отсутствии систематических ошибок получим ошибку единицы веса и СКО средних значений:
$$\mu=\sqrt{\frac{p_dd^2}n}$$
$$m_{x_{i,ср}}=\frac\mu{\sqrt{2p_i}}$$
Если разности $d_i$ содержат систематические ошибки, то величина $\Theta=[pd]/[p]$ будет заметно отличаться от нуля. Тогда будем иметь:
$$\mu=\sqrt{\frac{[p_dd'^2]}{n-1}}$$
где $d'_i=d_i-\Theta$.

Критерием наличия постоянной систематической ошибки может служить невыполнение неравенства
$$|[p_dd|\leq2.5[|p_dd|]/\sqrt{[p_d]}$$

### Нормальная стандартная величина. Правило трёх сигм.

Величину $t=\frac{x-Mx}{\sigma}$ называют нормальной стандартной величиной. Она обладает следующими свойствами:
1. $Mt=M(\frac{x-Mx}{\sigma})=\frac{1}{\sigma}\left(Mx-M(Mx)\right)=\frac{1}{\sigma}\left(Mx-Mx\right)=0$;
2. $D_t=D(\frac{x-Mx}{\sigma})=\frac{1}{\sigma^2}\left(Dx-D(Mx)\right)=\frac{1}{\sigma^2}\cdot Dx=1$;

Учитывая, что функция Лапласа нечётная, а также с учётом формулы для вычисления $t$, получим
$$mP(|x-a|\leq t\cdot\sigma)=\Phi(t)$$
При $t=1$, $\Phi(t)=0.68$; при $t=2$, $\Phi(t)=0.975$; при $t=3$, $\Phi(t)=0.997$.

Таким образом, если случайная величина распределена нормально, то её отклонение от математического ожидания, взятое по абсолютной величине, не превышает утроенного СКО с вероятностью 99.7%.

### Формула обобщённой оценки точности

Пусть $\varphi(X)$ - вектор-функция, $Y=M\varphi(X)$ - вектор-функция математических ожиданий вектор-функции $\varphi(X)$. Формула обобщённой теоремы оценки точности:
$$K_Y=A\cdot K_X\cdot A^T$$
где $K_Y$ - корреляционная матрица математических ожиданий; $K_X$ - корреляционная матрица аргументов функций; $A$ - матрица частных производных;
$$A_{ij}=\frac{\partial Y_i}{\partial X_j}$$

### Переопределённые системы уравнений.

Часто в геодезической практике число уравнений $n$ больше числа неизвестных $k$. Такую систему уравнений называют переопределённой. Решений она не имеет. Рассмотрим уравнение:
$$\underset{n\times k}{A}\cdot\underset{k\times1}{x}+\underset{n\times 1}{C}=0$$
Чтобы решить данную систему, её умножают слева на $\underset{k\times n}{A^T}\cdot\underset{n\times n}{S}$. Так, система будет состоять из $k$ уравнений и $k$ неизвестных.
$$A^TSAx+A^TSC=0$$
Пусть $\underset{k\times k}{R}=\underset{k\times n}{A^T}\cdot\underset{n\times n}{S}\cdot\underset{n\times k}{A}$; $\underset{k\times1}{b}=\underset{k\times n}{A^T}\cdot\underset{n\times n}{S}\cdot\underset{n\times1}{C}$.
$$\underset{k\times k}{R}\cdot\underset{k\times 1}{x}+\underset{k\times 1}{b}=0$$
Матрица $R$ является нормальной ($R^TR=RR^T$), поэтому полученная система уравнений называется системой нормальных уравнений.

Система уравнений будет иметь решение, если $rank A=k$, то есть матрица $A$ должна иметь $k$ независимых столбцов. $A\times A^T=E$.

Получим: $$x=-R^{-1}b$$
Но при подстановке данного решения в исходную систему, получим один из следующих случаев:
$$Ax+C=0\quad\text{или}\quad Ax+C=V$$
При $Ax+C=0$ система совместна. При $Ax+C=V$ система несовместна, однако матрица $V$ будет обладать следующим свойством:
$$V^TSV=\min$$
Докажем это свойство. Обозначим $\Phi=V^TSV$, $V=Ax+C$. Найдём экстремум этой функции, приравняв производную к нулю:
$$\frac{\partial\Phi}{\partial x}=\frac{\partial\Phi}{\partial V}\frac{\partial V}{\partial x}=\frac{\partial V^TSV}{\partial V}\frac{\partial Ax+C}{\partial x}=2V^TS\cdot A$$
$$2V^TSA=0$$
$$A^TSV=0$$
$$A^TS(Ax+C)=0$$
$$A^TSAx+A^TSC=0$$
Мы опять пришли к нормальному уравнению. Это значит, что решение уравнения является минимумом функции $\Phi$.

### Задача уравнивания.

При построении геодезических сетей мы измеряем различные величины: длины линий, углы, превышения, время (в спутниковых сетях) при том, что определяемыми величинами являются плановые и высотные координаты пунктов геодезических сетей.

Число измерений $n$ всегда больше числа координат. Наличие в сети избыточных измерений приводит к неоднозначности определения неизвестных. В этом случае возникает задача уравнивания.

Задачей уравнивания называется определение наиболее достоверных значений неизвестных и оценка их точности. Несмотря на сложность задачи, избыточные измерения позволяют контролировать результаты измерений, выполнять оценку точности и повышать надёжность результатов.

Существует два основных способа уравнивания: параметрический и коррелатный.

Обозначают:
$X$ - истинные значения неизвестных параметров;
$Y$ - истинные значения измеренных величин;
$y$ - результаты измерений.

### Параметрический способ уравнивания. Вывод основных формул, порядок уравнивания.

Запишем уравнения связи между измеренными значениями и неизвестными
$$Y=\varphi(X)$$
В общем случае уравнения связи нелинейные. Приведём их к линейному виду, разложив в ряд Тейлора:
$$Y=\varphi\left(X^{(0)}\right)+\left(\frac{\partial Y}{\partial X}\right)\left(X-X^{(0)}\right)+\zeta$$
Где $X^{(0)}$ - приближённое значение неизвестных; $\zeta$ - остаточный член.
Примем $\left(\frac{\partial Y}{\partial X}\right)=A$; $\zeta=0$; $X-X^{(0)}=\Delta X$; $\varphi(X^{(0)})-Y=\overline{L}$.
$$\underset{n\times k}{A}\cdot\underset{k\times 1}{\Delta X}+\underset{n\times 1}{L}=0$$
Данная система является переопределённой, т.к. $n>k$. Ранее, чтобы перейти к определённой системе, мы умножали её слева на $A^TS$, где $S$ - квадратная матрица размера $n\times n$. В геодезии в качестве матрицы $S$ мы используем матрицу весов измерений $P$.
$$A^TPA\Delta X+A^TP\overline{L}=0$$
Пусть $R=A^TPA$, $\overline{b}=A^TP\overline{L}$
$$R\Delta X+\overline{b}=0$$
$$\Delta X=-R^{-1}\overline{b}$$
Из принятого ранее $X-X^{(0)}=\Delta X$, получим:
$$X=X^{(0)}+\Delta X$$
Задача была бы решена, если бы нам был известен вектор $Y$ истинных измерений. Но у нас есть лишь результаты измерений $y$. И вместо вектора $\overline{L}$ мы вычислим вектор $L$:
$$L=\varphi(X^{(0)})-y$$
Тогда вместо поправок к истинным значениям неизвестных мы получим поправки к уравненным значениям неизвестных.
$$R\Delta x+b=0,\quad b=A^TPL$$
$$\Delta x=-R^{-1}b$$
$$\widetilde{X}=X^{(0)}+\Delta x$$
Если теперь полученный вектор-решение $\Delta x$ подставить в переопределённую систему уравнений, получим несовместную систему:
$$A\Delta x+L=V$$
где $V$ - поправка к измеренному значению, полученное из уравнивания. Если в исходную систему связи измеренных значений и неизвестных вместо истинного значения $X$ подставить уравненное $\widetilde{X}$, то получим уравненное значение измерений. 
$$y+V=\varphi(\widetilde{X})$$
$$\widetilde{y}=y+V$$

Порядок уравнивания параметрическим способом:
1. Выбираем неизвестные и обозначаем из за $X$;
2. Составляем уравнения связи между измеренными значениями и неизвестными в виде функции от неизвестных $$y=\varphi(x)$$
3. Составляем параметрические уравнения поправок $$\underset{n\times1}{V}=\underset{n\times k}{A}\cdot\underset{k\times 1}{\Delta x}+\underset{n\times 1}{L}$$ где $V$ - матрица поправок к измеренным значениям, полученным из уравнивания; $A$ - матрица коэффициентов уравнений поправок; $L$ - матрица свободных членов уравнений поправок. В подробной записи: $$\underset{n\times k}{A}=\begin{pmatrix}a_1&b_1&\ldots&g_1\\\ a_2&b_2&\ldots&g_2\\\ \vdots&\vdots&\ddots&\vdots\\\ a_n&b_n&\ldots&g_n\end{pmatrix}$$ $$v_i=a_i\delta x_i+b_i\delta x_2+\ldots+g_i\delta x_k+l_i$$ $$a_i=\frac{\partial y_i}{\partial x_1};\quad b_i=\frac{\partial y_i}{\partial x_2};\quad\ldots;\quad g_i=\frac{\partial y_i}{\partial x_k};\quad l_i=\varphi_i(x)-y$$
4. Находим приближённые значения неизвестных $X^{(0)}$ и вычисляем свободные члены параметрических уравнений поправок $$L=\varphi(x)-y$$
5. Составим систему нормальных уравнений $$R\Delta x+b=0$$ где $R=A^TPA$ - матрица коэффициентов нормальных уравнений. Она имеет следующие свойства:
	1. Под диагонали стоят квадратичные элементы;
	2. Недиагональные элементы симметричны относительно главной диагонали;
	3. Определитель матрицы $R$ положительный.
6. Находим поправки к приближённым значениям неизвестных как вектор решения нормальных уравнений: $$\Delta x=-R^{-1}b$$
7. Вычисляем уравненное значение неизвестных: $$\widetilde{X}=X^{(0)}+\Delta x$$
8. Оценка точности.

### Контроль уравнительных вычислений.

Контроль уравнительных вычислений выполняется вычислением квадратичной формы $\Phi$ двумя способами. Первый способ:

$$\Phi=[pv^2]=V^TPV=(A\Delta x+L)^TP(A\Delta x+L)=$$
$$=(\Delta x^TA^T+L^T)P(A\Delta x+L)=(\Delta x^TA^TP+L^TP)(A\Delta x+L)=$$
$$=\Delta x^TA^TPA\Delta x+\Delta x^TA^TPL+L^TPA\Delta x+L^TPL=$$
$$=\Delta x^T(\underbrace{A^TPA\Delta x+A^TPL}_{R\Delta x+b=0})+L^TPA\Delta x+L^TPL=$$
$$=L^TPA\Delta x+L^TPL=b^T\Delta x+L^TPL$$

Второй способ. Сначала вычислим уравненное значение свободного члена.
$$L=\varphi(X^{(0)})-y$$
$$\widetilde{L}=\varphi(X^{(0)}+\Delta x)-y=\varphi(\widetilde{X})-y$$
При его вычислении уже был учтён вектор решения $\Delta x$, поэтому вместо $\Phi=b^T\Delta x+L^TPL$ можно записать:
$$\Phi=\widetilde{L}^TP\widetilde{L}$$

Контролем уравнительных вычислений будет соблюдение равенств $\Phi$, полученных по двум формулам в пределах ошибки округления.

### Оценка точности в параметрическом способе уравнивания.

#### Ошибка единицы веса

Ошибка единицы веса вычисляется по формуле:
$$\mu=\sqrt{\frac{[pv^2]}{n-k}}$$
где $[pv^2]=\Phi$; $n$ - общее число измерений; $k$ - число необходимых измерений. Эта формула называется формулой Бесселя при уравнительных вычислениях. Вывод этой формулы содержится в коррелатном способе уравнивания.

#### Оценка точности уравненных неизвестных
$$\widetilde{X}=X^{(0)}+\Delta x$$
Так как $\widetilde{X}$ представляет собой несколько функций, для оценки точности этих величин надо знать корреляционную матрицу, которая может быть получена по обобщённой теореме оценки точности. Но чтобы использовать эту теорему, необходимо выразить уравнение в виде линейной функции с известной корреляционной матрицей.
$$\widetilde{X}=X^{(0)}+(-R^{-1}b)=$$
$$=X^{(0)}+\left(-(A^TPA)^{-1}A^TPL\right)=$$
$$=X^{(0)}+\left(-(A^TPA)^{-1}A^TP(\varphi(X^{(0)})-y)\right)=$$
$$=X^{(0)}+R^{-1}A^TP\varphi(X^{(0)})+R^{-1}A^TPy$$
Обозначим $C_1=X^{(0)}+R^{-1}A^TP\varphi(X^{(0)})$; $C=R^{-1}A^TP$. Получим:
$$\widetilde{X}=Cy+C_1$$
Применим обобщённую теорему оценки точности:
$$K_{\widetilde{X}}=CK_yC^T=R^{-1}A^TPK_yPAR^{-1}$$
Любую неравноточную величину можно оценить по формуле:
$$\sigma_i=\sigma_o\sqrt{\frac{1}{P_i}}$$
где $\sigma_i$ - СКО $i$-й неравноточной величины; $\sigma_0$ - СКО единицы веса. Если измерения независимы, то корреляционную матрицу измерений $K_y$ можно представить в виде
$$K_y=diag\{\sigma_i^2\}=\sigma_0^2\cdot P^{-1}$$
Вернёмся к обобщённой теореме оценки точности:
$$K_{\widetilde{X}}=\sigma_0^2\cdot R^{-1}\underbrace{A^TPP^{-1}PA^T}_{R}R^{-1}=\sigma_0^2\cdot R^{-1}$$

Обозначим $Q=R^{-1}$ - матрица обратных весов уравненных неизвестных. На диагонали у неё будут стоять обратные веса ($Q_{ii}=\frac{1}{P_{\widetilde{X_i}}}$), а недиагональные элементы - это корреляционные моменты.
$$K_{x_ix_j}=\sigma_0^2Q_{ij};\quad r_{x_ix_j}=\frac{K_{x_ix_j}}{\sigma_{x_i}\sigma_{x_j}}=\frac{\sigma_0^2Q_{ij}}{\sigma_0\sqrt{Qii}\cdot\sigma_0\sqrt{Q_{jj}}}=\frac{Q_{ij}}{\sqrt{Qii}\sqrt{Q_{jj}}}$$

#### Оценка точности функции уравненных неизвестных

Часто нужно оценить не только уравненные неизвестные, но и их функции (превышения, длины линий, дирекционные углы).
$$\widetilde{F}=F(\widetilde{X_1}, \widetilde{X_2},\ldots,\widetilde{X_k})$$
В общем случае функция уравненных весов нелинейна. Приведём её к линейному виду, используя ряд Тейлора.
$$\widetilde{F}=F\left(X^{(0)}\right)+\left(\frac{\partial\widetilde F}{\partial X}\right)\left(\widetilde{X}-X^{(0)}\right)+\zeta$$
Пусть $\frac{\partial\widetilde{F}}{\partial X}=\varphi$, $\varphi_{ij}=\frac{\partial F_i(\widetilde X)}{\partial X_j}$, $\zeta=0$, $\widetilde{X}-X^{(0)}=\Delta x$
$$\widetilde{F}=F(X^{(0)})+\varphi\Delta x$$
Для оценки точности функции уравненных значений $\widetilde{F}$ применим обобщённую теорему оценки точности.
$$K_{\widetilde{F}}=\varphi K_{\Delta x}\varphi^T$$
Учитывая, что $K_{\Delta x}=K_{\widetilde{x}}=\sigma_0^2\cdot Q$, получим:
$$K_{\widetilde{F}}=\sigma_0^2\cdot\varphi Q\varphi^T=\sigma_0^2\cdot P_{\widetilde{F}}^{-1}$$
Откуда $$P_{\widetilde{F}}^{-1}=\varphi Q\varphi^{-1}$$